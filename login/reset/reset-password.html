<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reset Password - TubeEarn</title>
<style>
    body { font-family: Arial; background: linear-gradient(to right,#43cea2,#185a9d); display:flex; justify-content:center; align-items:center; height:100vh; margin:0;}
    .card { background:white; padding:30px 40px; border-radius:10px; box-shadow:0 5px 10px rgba(0,0,0,0.2); width:320px; text-align:center; }
    input, button { width:100%; padding:10px; margin-bottom:15px; font-size:14px; border-radius:8px; border:1px solid #ccc; }
    button { background:#43cea2; color:white; border:none; cursor:pointer; }
    button:hover { background:#2abb87; }
    #msg { font-weight:bold; margin-bottom:15px; height:20px;}
</style>
</head>
<body>
<div class="card">
    <div id="msg"></div>
    <h2>Reset Password</h2>
    <input type="password" id="newPassword" placeholder="New Password">
    <input type="password" id="confirmPassword" placeholder="Confirm Password">
    <button id="resetBtn">Submit</button>
</div>

<script type="module">
import { BACKEND_URL } from '../../secure/config/configure.js';

const msgBox = document.getElementById('msg');
const token = new URLSearchParams(window.location.search).get('token');

document.getElementById('resetBtn').addEventListener('click', async ()=>{
    const pass = document.getElementById('newPassword').value.trim();
    const confirm = document.getElementById('confirmPassword').value.trim();

    if(!pass || !confirm){
        msgBox.style.color="red";
        msgBox.textContent="⚠ Please fill in both fields.";
        return;
    }
    if(pass !== confirm){
        msgBox.style.color="red";
        msgBox.textContent="⚠ Passwords do not match.";
        return;
    }

    msgBox.style.color="#555";
    msgBox.textContent="⏳ Processing...";

    try{
        const res = await fetch(`${BACKEND_URL}/reset-password`,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({ token, password:pass })
        });
        const data = await res.json();
        if(res.ok){
            msgBox.style.color="green";
            msgBox.textContent="✅ Password reset successful! Redirecting...";
            setTimeout(()=>{ window.location.href='../login.html'; },2000);
        } else {
            msgBox.style.color="red";
            msgBox.textContent=data.message || "❌ Reset failed.";
        }
    }catch(e){
        msgBox.style.color="red";
        msgBox.textContent="❌ Server error.";
    }
});
</script>
</body>
</html>
