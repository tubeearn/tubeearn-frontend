<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Forgot Password - TubeEarn</title>
<style>
  :root { --accent: #00b09b; --accent-dark: #028a77; --bg: linear-gradient(to right, #00b09b, #96c93d); }
  html,body { height:100%; margin:0; padding:0; font-family: Arial, sans-serif; background: var(--bg); }
  body {
    display:flex;
    justify-content:center;
    align-items:flex-start; /* top aligned */
    padding-top:48px;       /* spacing from top */
    min-height:100vh;
  }
  .container {
    width: min(720px, 90%);
    max-width:600px;
    background:#fff;
    border-radius:12px;
    padding:32px;
    box-shadow:0 8px 30px rgba(0,0,0,0.15);
    text-align:center;
  }
  h1 { margin:0 0 6px; color: #0f6b5f; }
  p.lead { margin:0 0 18px; color:#444; font-size:16px; }
  form { margin-top:10px; }
  input[type="email"] {
    width:100%;
    padding:14px;
    border-radius:8px;
    border:1.5px solid #ddd;
    font-size:16px;
    box-sizing:border-box;
    margin-bottom:14px;
  }
  .btn {
    display:inline-block;
    width:100%;
    padding:14px;
    border-radius:8px;
    border:none;
    background:var(--accent);
    color:white;
    font-size:16px;
    cursor:pointer;
  }
  .btn[disabled]{ opacity:0.7; cursor:default; }
  .btn:hover:not([disabled]){ background:var(--accent-dark); }
  .msg { margin-top:14px; font-weight:600; min-height:22px; }
  .msg.error { color:#d93025; }
  .msg.success { color:#18833b; }
  .small { font-size:13px; color:#666; margin-top:8px; }
</style>
</head>
<body>
  <div class="container" role="main" aria-labelledby="h1">
    <h1 id="h1">Forgot Password?</h1>
    <p class="lead">Please enter your registered email address. We'll send a secure link to reset your password.</p>

    <form id="forgotForm" onsubmit="sendLink(event)">
      <input type="email" id="email" placeholder="Enter your registered email" aria-label="email" required />
      <button id="sendBtn" class="btn" type="submit">Send Reset Link</button>
    </form>

    <div id="message" class="msg" aria-live="polite"></div>
    <div class="small">If you don't see the email, check spam/promotions folder.</div>
  </div>

  <script type="module">
    // IMPORTANT: adjust relative path if your configure.js is located elsewhere.
    // From this file (login/forgot/forgot-password.html) to secure/config/configure.js
    // expected path is '../../secure/config/configure.js'
    import CONFIG from '../../secure/config/configure.js';

    const sendBtn = document.getElementById('sendBtn');
    const msgEl = document.getElementById('message');
    const emailInput = document.getElementById('email');

    async function sendLink(event) {
      event.preventDefault();
      msgEl.textContent = '';
      msgEl.className = 'msg';
      const email = emailInput.value.trim();

      if (!email) {
        msgEl.textContent = 'Please enter your registered email';
        msgEl.classList.add('error');
        return;
      }

      // disable button and show loading text
      sendBtn.disabled = true;
      const prevText = sendBtn.textContent;
      sendBtn.textContent = 'Please wait...';

      try {
        const res = await fetch(`${CONFIG.API_BASE_URL.replace(/\/$/, '')}/forgot-password`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });

        const data = await res.json().catch(() => ({}));

        if (res.ok) {
          // backend returned success (200)
          msgEl.textContent = data.message || 'Reset link sent! Check your email.';
          msgEl.classList.add('success');
        } else {
          // backend returned error status (e.g. 400/409/500)
          msgEl.textContent = data.message || 'Failed to send reset link. Please try again.';
          msgEl.classList.add('error');
        }
      } catch (err) {
        console.error('forgot-password error', err);
        msgEl.textContent = 'Network or server error. Please try again later.';
        msgEl.classList.add('error');
      } finally {
        // restore button
        sendBtn.disabled = false;
        sendBtn.textContent = prevText;
      }
    }

    // expose for onclick (form uses onsubmit) â€” not necessary but kept
    window.sendLink = sendLink;
  </script>
</body>
</html>
